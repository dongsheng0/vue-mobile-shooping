{"remainingRequest":"C:\\project_xcx\\vue-mobile-shooping\\node_modules\\babel-loader\\lib\\index.js!C:\\project_xcx\\vue-mobile-shooping\\node_modules\\cache-loader\\dist\\cjs.js??ref--0-0!C:\\project_xcx\\vue-mobile-shooping\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!C:\\project_xcx\\vue-mobile-shooping\\src\\pages\\product\\scenic\\order.vue?vue&type=script&lang=js&","dependencies":[{"path":"C:\\project_xcx\\vue-mobile-shooping\\src\\pages\\product\\scenic\\order.vue","mtime":1567675004997},{"path":"C:\\project_xcx\\vue-mobile-shooping\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\project_xcx\\vue-mobile-shooping\\node_modules\\babel-loader\\lib\\index.js","mtime":499162500000},{"path":"C:\\project_xcx\\vue-mobile-shooping\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\project_xcx\\vue-mobile-shooping\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["import \"core-js/modules/web.dom.iterable\";\nimport _typeof from \"C:\\\\project_xcx\\\\vue-mobile-shooping\\\\node_modules\\\\@babel\\\\runtime-corejs2/helpers/esm/typeof\";\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport serverHttp from \"../../../assets/js/api\";\nimport selectPicker from \"../../../components/common/selectpicker\";\nimport ticket from \"../../../components/detail/ticket\";\nimport WXPay from \"../../../assets/js/wxpay\"; // import moment from 'moment'\n\nexport default {\n  data: function data() {\n    return {\n      activeDate: '',\n      price: '',\n      // 单价\n      showDatetimePicker: false,\n      datetimePicker: '',\n      minDate: new Date(),\n      currentDate: new Date(),\n      detailId: this.$route.params.id,\n      details: {},\n      creatOrderForm: {\n        ticketId: +this.$route.params.id,\n        // 是\tint\t门票ID\n        preorderDate: '20190905',\n        // 是\tint\t预定日期 yyyyMMdd格式\n        buyNum: 1,\n        //\t是\tint\t购买数量\n        fillInfo: {\n          \"name\": \"wds\",\n          //姓名\n          \"mobile\": '1370123913',\n          //手机号\n          \"cardType\": 0,\n          \"cardNo\": \"130724198902123814\" //证件号\n\n        }\n      },\n      cardTypeOptions: [{\n        text: '身份证',\n        type: 0\n      }, {\n        text: '台胞证',\n        type: 1\n      }, {\n        text: '港澳通行证',\n        type: 2\n      }, {\n        text: '护照',\n        type: 3\n      }]\n    };\n  },\n  computed: {\n    allPrice: function allPrice() {\n      return this.creatOrderForm.buyNum * this.price;\n    }\n  },\n  components: {\n    selectPicker: selectPicker,\n    ticket: ticket\n  },\n  mounted: function mounted() {\n    this.preorder();\n  },\n  methods: {\n    selectCardType: function selectCardType(e) {\n      if (_typeof(e) == 'object') {\n        this.creatOrderForm.fillInfo.cardType = e.type;\n      }\n    },\n    // 提交订单\n    saveOrder: function saveOrder() {\n      console.log(this.creatOrderForm); // creatOrderForm\n      // infoRules\": { //必填信息规则\n      //       \"needAllGuestInfo\": false, //是否需要所有游客的信息\n      //       \"checkName\": true, //填写姓名\n      //       \"checkMobile\": true, //填写手机号\n      //       \"checkSfz\": true, //填写身份证号\n      //       \"checkTbz\": false, //填写台胞证\n      //       \"checkGatxz\": false, //填写港澳通行证\n      //       \"checkHz\": false//填写护照\n      //   }\n\n      if (!this.creatOrderForm.preorderDate) {\n        this.$toast('选择日期');\n      } else if (!this.creatOrderForm.fillInfo.name) {\n        this.$toast('姓名');\n      } else if (this.creatOrderForm.fillInfo.mobile) {\n        this.$toast('手机号');\n      } else if (this.creatOrderForm.preorderDate) {//\n      } else {\n        this.creatOrder();\n      }\n\n      this.creatOrder();\n    },\n    creatOrder: function creatOrder() {\n      var data = Object.assign({}, this.creatOrderForm);\n      data.fillInfo = JSON.stringify(data.fillInfo);\n      console.log(data);\n      serverHttp.scenicSpotsCreateOrderApi(data).then(function (res) {\n        WXPay(res.rs.orderNo);\n      });\n    },\n    // 更多日期\n    handelDatetimePicker: function handelDatetimePicker() {\n      this.showDatetimePicker = true;\n    },\n    // 今天，明天，后天\n    handelDatetime: function handelDatetime(item, i) {\n      this.activeDate = i;\n      this.creatOrderForm.preorderDate = item.stock_date;\n      this.datetimePicker = '';\n      this.price = this.details.priceAndStock[0].price; // 缺少选择某一天的价钱，就直接显示今天的价钱\n    },\n    // 选择日期-确定\n    onConfirmDatetimePicker: function onConfirmDatetimePicker(value) {\n      this.showDatetimePicker = !this.showDatetimePicker;\n      console.log(value);\n      this.datetimePicker = this.creatOrderForm.preorderDate = new Date(value).getMonth() + 1;\n      this.activeDate = -1;\n      this.price = item.price;\n    },\n    // 数量改变\n    changeOrderNum: function changeOrderNum() {},\n    // 获取订单详情\n    preorder: function preorder() {\n      var _this = this;\n\n      serverHttp.scenicSpotsPreorderApi({\n        id: parseInt(this.detailId)\n      }).then(function (res) {\n        _this.details = res.rs;\n        _this.details.source = 'scenic';\n        var dateName = ['今天', '明天', '后天'];\n\n        _this.details.priceAndStock.forEach(function (item, i) {\n          item.dateFromNow = dateName[i]; // item.date = `${moment(item.stock_date, \"YYYYMMDD\").get('month') + 1}/${moment(item.stock_date, \"YYYYMMDD\").get('day')}`\n        });\n      });\n    }\n  }\n};",{"version":3,"sources":["order.vue"],"names":[],"mappings":"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","sourcesContent":["\r\n\r\n<template>\r\n  <!-- 提交订单-景区 -->\r\n  <div class=\"order\">\r\n    <ticket :ticket=\"details\" />\r\n    <div class=\"left-bar\">使用日期</div>\r\n    <div class=\"date\">\r\n      <van-row type=\"flex\" justify=\"space-between\">\r\n        <van-col span=\"6\" v-for=\"(item, i) in details.priceAndStock\" :key=\"i\">\r\n          <div class=\"date-btn\" :class=\"{'active': activeDate==i? true: false}\" @click=\"handelDatetime(item,i)\">\r\n            <p>{{item.dateFromNow}}{{item.date}}</p>\r\n            <p>{{item.price}}元</p>\r\n          </div>\r\n        </van-col>\r\n        <van-col span=\"6\" @click=\"handelDatetimePicker\">\r\n          <div class=\"date-btn date-btn-last\">\r\n            <p>更多日期</p>\r\n            <p>{{datetimePicker}}</p>\r\n            <p></p>\r\n          </div>\r\n        </van-col>\r\n      </van-row>\r\n    </div>\r\n    <div class=\"left-bar\">购买数量</div>\r\n    <div class=\"order-num\">\r\n      <van-stepper\r\n        v-model=\"creatOrderForm.buyNum\"\r\n        :max=\"details.maxPerOrder\"\r\n        integer\r\n        input-width=\"60px\"\r\n        @change=\"changeOrderNum\"\r\n      />\r\n      <div class=\"tips\">\r\n        <p v-for=\"(item, i) in details.useRules\" :key=\"i\">{{item}}</p>\r\n      </div>\r\n    </div>\r\n    <div class=\"left-bar\">预订人信息</div>\r\n    <div class=\"order-userinfo\">\r\n      <div class=\"field-label\">联系人</div>\r\n      <van-field v-model=\"creatOrderForm.fillInfo.name\" placeholder=\"请输入用户名\" />\r\n      <div class=\"field-label\">手机号</div>\r\n      <van-field v-model=\"creatOrderForm.fillInfo.mobile\" placeholder=\"请输入接收信息的手机号\" />\r\n      <div class=\"field-label\">证件类型</div>\r\n      <select-picker\r\n        placeholder=\"请选择证件类型\"\r\n        :selectValue=\"creatOrderForm.fillInfo.cardType\"\r\n        @select=\"selectCardType\"\r\n        :columns=\"cardTypeOptions\"\r\n      />\r\n      <div class=\"field-label\">证件号</div>\r\n      <van-field v-model=\"creatOrderForm.fillInfo.cardNo\" placeholder=\"请输入证件号\" />\r\n      <div class=\"field-label\">备注信息</div>\r\n      <van-field type=\"textarea\" rows=\"1\" autosize placeholder=\"请输入备注信息\" />\r\n    </div>\r\n    <!-- 提交订单 -->\r\n    <div class=\"save-order\">\r\n      <van-row type=\"flex\" justify=\"space-between\" align=\"center\">\r\n        <van-col span=\"6\" class>￥{{allPrice}}</van-col>\r\n        <van-col span=\"18\" class=\"save-order-btn\">\r\n          <span @click=\"saveOrder\">提交订单</span>\r\n        </van-col>\r\n      </van-row>\r\n    </div>\r\n    <!-- 提交订单 -->\r\n    <van-popup v-model=\"showDatetimePicker\" position=\"bottom\">\r\n      <van-datetime-picker\r\n        v-model=\"currentDate\"\r\n        type=\"date\"\r\n        :min-date=\"minDate\"\r\n        @cancel=\"showDatetimePicker = !showDatetimePicker\"\r\n        @confirm=\"onConfirmDatetimePicker\"\r\n      />\r\n    </van-popup>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport serverHttp from '../../../assets/js/api'\r\nimport selectPicker from '../../../components/common/selectpicker'\r\nimport ticket from \"../../../components/detail/ticket\";\r\nimport WXPay from '../../../assets/js/wxpay'\r\n// import moment from 'moment'\r\nexport default {\r\n  data () {\r\n    return {\r\n      activeDate: '',\r\n      price: '', // 单价\r\n      showDatetimePicker: false,\r\n      datetimePicker: '',\r\n      minDate: new Date(),\r\n      currentDate: new Date(),\r\n      detailId: this.$route.params.id,\r\n      details: {},\r\n      creatOrderForm: {\r\n        ticketId: +this.$route.params.id,\t// 是\tint\t门票ID\r\n        preorderDate: '20190905', \t// 是\tint\t预定日期 yyyyMMdd格式\r\n        buyNum: 1, //\t是\tint\t购买数量\r\n        fillInfo: {\r\n          \"name\": \"wds\", //姓名\r\n          \"mobile\": '1370123913', //手机号\r\n          \"cardType\": 0,\r\n          \"cardNo\": \"130724198902123814\" //证件号\r\n        }\r\n      },\r\n      cardTypeOptions: [\r\n        { text: '身份证', type: 0 },\r\n        { text: '台胞证', type: 1 },\r\n        { text: '港澳通行证', type: 2 },\r\n        { text: '护照', type: 3 },\r\n      ]\r\n    }\r\n  },\r\n  computed: {\r\n    allPrice () {\r\n      return this.creatOrderForm.buyNum * this.price\r\n    }\r\n  },\r\n  components: {\r\n    selectPicker,\r\n    ticket\r\n  },\r\n  mounted () {\r\n    this.preorder()\r\n  },\r\n  methods: {\r\n    selectCardType (e) {\r\n      if (typeof e == 'object') {\r\n        this.creatOrderForm.fillInfo.cardType = e.type\r\n      }\r\n    },\r\n    // 提交订单\r\n    saveOrder () {\r\n      console.log(this.creatOrderForm);\r\n      // creatOrderForm\r\n      // infoRules\": { //必填信息规则\r\n      //       \"needAllGuestInfo\": false, //是否需要所有游客的信息\r\n      //       \"checkName\": true, //填写姓名\r\n      //       \"checkMobile\": true, //填写手机号\r\n      //       \"checkSfz\": true, //填写身份证号\r\n      //       \"checkTbz\": false, //填写台胞证\r\n      //       \"checkGatxz\": false, //填写港澳通行证\r\n      //       \"checkHz\": false//填写护照\r\n      //   }\r\n\r\n      if (!this.creatOrderForm.preorderDate) {\r\n        this.$toast('选择日期')\r\n      } else if (!this.creatOrderForm.fillInfo.name) {\r\n        this.$toast('姓名')\r\n      } else if (this.creatOrderForm.fillInfo.mobile) {\r\n        this.$toast('手机号')\r\n      } else if (this.creatOrderForm.preorderDate) {\r\n        //\r\n      } else {\r\n        this.creatOrder()\r\n      }\r\n      this.creatOrder()\r\n    },\r\n    creatOrder () {\r\n      let data = Object.assign({}, this.creatOrderForm)\r\n      data.fillInfo = JSON.stringify(data.fillInfo)\r\n      console.log(data)\r\n      serverHttp.scenicSpotsCreateOrderApi(data).then(res => {\r\n        WXPay(res.rs.orderNo)\r\n      })\r\n    },\r\n    // 更多日期\r\n    handelDatetimePicker () {\r\n      this.showDatetimePicker = true\r\n    },\r\n    // 今天，明天，后天\r\n    handelDatetime (item, i) {\r\n      this.activeDate = i\r\n      this.creatOrderForm.preorderDate = item.stock_date\r\n      this.datetimePicker = ''\r\n      this.price = this.details.priceAndStock[0].price // 缺少选择某一天的价钱，就直接显示今天的价钱\r\n    },\r\n    // 选择日期-确定\r\n    onConfirmDatetimePicker (value) {\r\n      this.showDatetimePicker = !this.showDatetimePicker\r\n      console.log(value)\r\n      this.datetimePicker = this.creatOrderForm.preorderDate = (new Date(value).getMonth()) + 1\r\n      this.activeDate = -1\r\n      this.price = item.price\r\n    },\r\n    // 数量改变\r\n    changeOrderNum () {\r\n\r\n    },\r\n    // 获取订单详情\r\n    preorder () {\r\n      serverHttp.scenicSpotsPreorderApi({ id: parseInt(this.detailId) }).then(res => {\r\n        this.details = res.rs\r\n        this.details.source = 'scenic'\r\n        let dateName = ['今天', '明天', '后天']\r\n        this.details.priceAndStock.forEach((item, i) => {\r\n          item.dateFromNow = dateName[i]\r\n          // item.date = `${moment(item.stock_date, \"YYYYMMDD\").get('month') + 1}/${moment(item.stock_date, \"YYYYMMDD\").get('day')}`\r\n        });\r\n      })\r\n    },\r\n  }\r\n}\r\n</script>\r\n<style lang=\"less\" scoped>\r\n@import \"../../../assets/style/global\";\r\n.order {\r\n  .date {\r\n    color: #424242;\r\n    margin: 0.5rem 0;\r\n\r\n    &-btn {\r\n      margin-left: 10px;\r\n      padding: 10px 0;\r\n      display: block;\r\n      line-height: 18px;\r\n      text-align: center;\r\n      box-shadow: 0px 6px 12px 0px rgba(0, 0, 0, 0.08);\r\n      border-radius: 13px;\r\n      background: #fff;\r\n      &.active {\r\n        color: #fff;\r\n        background: linear-gradient(\r\n          -90deg,\r\n          rgba(254, 167, 99, 0.5) 0%,\r\n          rgba(242, 111, 84, 1) 100%\r\n        );\r\n      }\r\n    }\r\n    &-btn-last {\r\n      border-radius: 13px 0 0 13px;\r\n      height: 100%;\r\n      box-sizing: border-box;\r\n      line-height: 36px;\r\n    }\r\n  }\r\n  .tips {\r\n    text-align: left;\r\n    padding-bottom: 5px;\r\n    font-size: 12px;\r\n    padding-left: 15px;\r\n    p {\r\n      color: rgba(254, 163, 98, 1);\r\n    }\r\n  }\r\n}\r\n</style>"],"sourceRoot":"src/pages/product/scenic"}]}